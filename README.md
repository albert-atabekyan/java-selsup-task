
# CrptApi Java Библиотека

## Описание

`CrptApi` — это Java-библиотека, разработанная для взаимодействия с API Честного Знака (Центральный реестр прослеживаемости товаров), позволяющая создавать документы для ввода товаров в оборот. Библиотека управляет ограничениями на количество запросов с помощью семафора и планировщика, который периодически сбрасывает лимиты запросов.

## Возможности

- **Ограничение количества запросов**: Управляет количеством запросов с помощью семафора, чтобы соблюдать ограничения на количество запросов к API.
- **Создание документов**: Отправляет HTTP POST запросы для создания документов через API Честного Знака.
- **Безопасная многопоточность**: Использует `ReentrantLock` для безопасного управления операциями освобождения семафора в многопоточном окружении.
- **Работа с JSON**: Использует Jackson `ObjectMapper` для преобразования объектов Java в JSON для отправки в API.

## Предварительные требования

- Java Development Kit (JDK) версии 8 или выше.
- Maven или Gradle для управления зависимостями.
- Необходимая зависимость: библиотека Jackson Databind для работы с JSON.

## Установка

1. **Клонирование репозитория:**

   ```bash
   git clone <ссылка-на-репозиторий>
   cd <папка-репозитория>
   ```

2. **Добавление зависимостей:**

   Если вы используете Maven, добавьте следующую зависимость в `pom.xml`:

   ```xml
   <dependency>
       <groupId>com.fasterxml.jackson.core</groupId>
       <artifactId>jackson-databind</artifactId>
       <version>2.13.4</version>
   </dependency>
   ```

   Для Gradle добавьте эту строку в ваш `build.gradle`:

   ```groovy
   implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.4'
   ```

## Использование

### Инициализация CrptApi

Создайте экземпляр `CrptApi`, указав единицу времени для сброса лимита запросов и максимальное количество разрешённых запросов:

```java
CrptApi api = new CrptApi(TimeUnit.MINUTES, 100);
```

### Создание документа

Для создания документа используйте метод `createDocumentForGoods`:

```java
CrptApi.Document document = new CrptApi.Document();
// Заполните необходимые поля документа
document.doc_id = "12345";
// Заполните другие поля

String signature = "ваша-подпись";

try {
    api.createDocumentForGoods(document, signature);
} catch (IOException | InterruptedException e) {
    e.printStackTrace();
}
```

### Структура документа

- **Document**: Представляет документ для отправки.
  - `description`: Содержит описание документа.
  - `doc_id`, `doc_status`, `doc_type` и другие поля: различные параметры документа.
  - `products`: Массив объектов `Product`.

- **Description**: Описание документа.
  - `participantInn`: ИНН участника.

- **Product**: Описание товара.
  - `certificate_document`, `production_date` и другие поля: параметры товара.

## Обработка ошибок

- Если сервер отвечает кодом состояния HTTP, отличным от `200 OK`, будет выведено сообщение об ошибке в консоль.

## Примечания

- Убедитесь, что URL-адрес API (`https://ismp.crpt.ru/api/v3/lk/documents/create`) правильный и доступный.
- Семафор настроен для обработки указанного количества запросов за единицу времени. Настройте параметры `requestLimit` и `timeUnit` в зависимости от требований API.

## Вклад в проект

Вы можете форкнуть репозиторий и отправить pull request для улучшений или исправлений. Пожалуйста, следуйте стандартам кодирования проекта и добавляйте соответствующие тесты.

## Лицензия

Этот проект лицензирован под лицензией MIT. См. файл [LICENSE](LICENSE) для получения дополнительной информации.
